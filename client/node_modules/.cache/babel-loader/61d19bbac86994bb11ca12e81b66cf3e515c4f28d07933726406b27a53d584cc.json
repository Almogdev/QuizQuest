{"ast":null,"code":"import _objectSpread from\"D:/QuizQuest/QuizQuest/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState,useMemo}from\"react\";import{APIProvider,Map,Marker,InfoWindow}from\"@vis.gl/react-google-maps\";import Header from\"../../components/Header/Header\";import Footer from\"../../components/Footer/Footer\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const MapPage=()=>{var _selected$score;const apiKey=process.env.REACT_APP_GOOGLE_MAPS_API_KEY;const[schools,setSchools]=useState([]);const[selectedId,setSelectedId]=useState(null);useEffect(()=>{fetch(\"/api/schools\").then(r=>r.json()).then(data=>setSchools(Array.isArray(data)?data:[])).catch(e=>console.error(\"Failed to fetch schools:\",e));},[]);const markers=useMemo(()=>schools.filter(s=>s.lat!=null&&s.lng!=null).map(s=>_objectSpread(_objectSpread({},s),{},{position:{lat:Number(s.lat),lng:Number(s.lng)}// MySQL DECIMAL may arrive as strings\n})),[schools]);const selected=useMemo(()=>markers.find(m=>m.id===selectedId),[markers,selectedId]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsx(APIProvider,{apiKey:apiKey,onLoad:()=>console.log(\"Maps API loaded\"),children:/*#__PURE__*/_jsx(\"div\",{style:{width:\"100%\",height:735,borderRadius:12,overflow:\"hidden\",margin:\"0px 0\"},children:/*#__PURE__*/_jsxs(Map,{defaultCenter:{lat:32.0853,lng:34.7818}// Tel Aviv\n,defaultZoom:8,gestureHandling:\"greedy\",disableDefaultUI:false,children:[markers.map(m=>{var _m$score;return/*#__PURE__*/_jsx(Marker,{position:m.position,title:\"\".concat(m.name,\" (\").concat(m.city||\"Unknown city\",\") - \").concat((_m$score=m.score)!==null&&_m$score!==void 0?_m$score:0,\" pts\"),onClick:()=>setSelectedId(m.id)},m.id);}),selected&&/*#__PURE__*/_jsx(InfoWindow,{position:selected.position,onCloseClick:()=>setSelectedId(null),children:/*#__PURE__*/_jsxs(\"div\",{style:{minWidth:200},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600,marginBottom:4},children:selected.name}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:12,opacity:0.8},children:[selected.city||\"Unknown city\",\" · \",\"Score: \",(_selected$score=selected.score)!==null&&_selected$score!==void 0?_selected$score:0,selected.best_category?\" \\xB7 Best: \".concat(selected.best_category):\"\"]})]})})]})})}),/*#__PURE__*/_jsx(Footer,{})]});};export default MapPage;","map":{"version":3,"names":["React","useEffect","useState","useMemo","APIProvider","Map","Marker","InfoWindow","Header","Footer","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","MapPage","_selected$score","apiKey","process","env","REACT_APP_GOOGLE_MAPS_API_KEY","schools","setSchools","selectedId","setSelectedId","fetch","then","r","json","data","Array","isArray","catch","e","console","error","markers","filter","s","lat","lng","map","_objectSpread","position","Number","selected","find","m","id","children","onLoad","log","style","width","height","borderRadius","overflow","margin","defaultCenter","defaultZoom","gestureHandling","disableDefaultUI","_m$score","title","concat","name","city","score","onClick","onCloseClick","minWidth","fontWeight","marginBottom","fontSize","opacity","best_category"],"sources":["D:/QuizQuest/QuizQuest/client/src/pages/map/map.jsx"],"sourcesContent":["import React, { useEffect, useState, useMemo } from \"react\";\r\nimport { APIProvider, Map, Marker, InfoWindow } from \"@vis.gl/react-google-maps\";\r\nimport Header from \"../../components/Header/Header\";\r\nimport Footer from \"../../components/Footer/Footer\";\r\n\r\nconst MapPage = () => {\r\n  const apiKey = process.env.REACT_APP_GOOGLE_MAPS_API_KEY;\r\n  const [schools, setSchools] = useState([]);\r\n  const [selectedId, setSelectedId] = useState(null);\r\n\r\n  useEffect(() => {\r\n    fetch(\"/api/schools\")\r\n      .then((r) => r.json())\r\n      .then((data) => setSchools(Array.isArray(data) ? data : []))\r\n      .catch((e) => console.error(\"Failed to fetch schools:\", e));\r\n  }, []);\r\n\r\n  const markers = useMemo(\r\n    () =>\r\n      schools\r\n        .filter((s) => s.lat != null && s.lng != null)\r\n        .map((s) => ({\r\n          ...s,\r\n          position: { lat: Number(s.lat), lng: Number(s.lng) }, // MySQL DECIMAL may arrive as strings\r\n        })),\r\n    [schools]\r\n  );\r\n\r\n  const selected = useMemo(\r\n    () => markers.find((m) => m.id === selectedId),\r\n    [markers, selectedId]\r\n  );\r\n\r\n  return (\r\n    <>\r\n      <Header />\r\n      <APIProvider apiKey={apiKey} onLoad={() => console.log(\"Maps API loaded\")}>\r\n        <div style={{ width: \"100%\", height: 735, borderRadius: 12, overflow: \"hidden\", margin: \"0px 0\" }}>\r\n          <Map\r\n            defaultCenter={{ lat: 32.0853, lng: 34.7818 }} // Tel Aviv\r\n            defaultZoom={8}\r\n            gestureHandling={\"greedy\"}\r\n            disableDefaultUI={false}\r\n          >\r\n            {markers.map((m) => (\r\n              <Marker\r\n                key={m.id}\r\n                position={m.position}\r\n                title={`${m.name} (${m.city || \"Unknown city\"}) - ${m.score ?? 0} pts`}\r\n                onClick={() => setSelectedId(m.id)}\r\n              />\r\n            ))}\r\n\r\n            {selected && (\r\n              <InfoWindow\r\n                position={selected.position}\r\n                onCloseClick={() => setSelectedId(null)}\r\n              >\r\n                <div style={{ minWidth: 200 }}>\r\n                  <div style={{ fontWeight: 600, marginBottom: 4 }}>{selected.name}</div>\r\n                  <div style={{ fontSize: 12, opacity: 0.8 }}>\r\n                    {selected.city || \"Unknown city\"}\r\n                    {\" · \"}\r\n                    Score: {selected.score ?? 0}\r\n                    {selected.best_category ? ` · Best: ${selected.best_category}` : \"\"}\r\n                  </div>\r\n                </div>\r\n              </InfoWindow>\r\n            )}\r\n          </Map>\r\n        </div>\r\n      </APIProvider>\r\n      <Footer />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default MapPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}